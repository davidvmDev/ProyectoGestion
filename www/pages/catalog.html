<template>
    <div class="page" data-name="catalog">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <a class="link back" href="/">
                    <i class="icon icon-back"></i>
                    <span class="if-not-md">Back</span>
                </a>
                <div class="title">Cemento</div>
                <div class="right">
                    <a href="#" class="link icon-only panel-open" data-panel="right">
                        <i class="icon f7-icons ios-only">menu</i>
                        <i class="icon material-icons md-only">menu</i>
                    </a>
                </div>
            </div>
        </div>
        <div class="page-content">

            <div class="block-title display-flex justify-content-space-between">Filtrar por precio<span class="price-value">$10000 - $20000</span></div>
            <div class="list simple-list">
                <ul>
                    <li class="item-row">
                        <div class="item-cell width-auto flex-shrink-0">

                            <i class="icon material-icons md-only ">monetization_on</i>
                        </div>
                        <div class="item-cell item-cell-shrink-3">
                            <!-- Dual range slider with all the parameters passed via data- attributes -->
                            <div id="price-filter"
                                 class="range-slider range-slider-init color-green"
                                 data-label="true"
                                 data-dual="true"
                                 data-min="0"
                                 data-max="100000"
                                 data-step="1000"
                                 data-value-left="10000"
                                 data-value-right="20000"></div>
                        </div>
                        <div class="item-cell width-auto flex-shrink-0">

                            <i class="icon material-icons md-only ">monetization_on</i>
                        </div>
                    </li>
                </ul>
            </div>
            <script>
                $$('#price-filter').on('range:change', function (e, range) {
                    $$('.price-value').text('$' + (range.value[0]) + ' - $' + (range.value[1]));
                });
            </script>

            <div class="block-title">Filtrar por peso</div>
            <div class="list no-hairlines-md">
                <ul>
                    <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popover">
                            <select name="Tipo" multiple id="pesoF">
                                <option value=50 selected>50kg</option>
                                <option value=25 selected>25kg</option>
                                <option value=10 selected>10kg</option>
                            </select>
                            <div class="item-content">
                                <i class=" icon material-icons md-only ifiltro">all_inbox</i>
                                <div class="item-inner chevron-center">
                                    <div class="item-title">Peso</div>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="block-title" id="ej" onclick="ejemplo()">Filtrar por Marca</div>
            <div class="list no-hairlines-md">
                <ul>
                    <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popover">
                            <select name="Marca" multiple id="marcaF">
                                <option value="Argos" selected>Argos</option>
                                <option value="Cemex" selected>Cemex</option>
                                <option value="Diamante" selected>Diamante</option>
                                <option value="Topex" selected>Topex</option>
                            </select>
                            <div class="item-content">
                                <i class="material-icons md-only icon ifiltro">group_work</i>
                                <div class="item-inner chevron-center">
                                    <div class="item-title">Marca</div>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="block-title">Filtrar por Deposito</div>
            <div class="list no-hairlines-md">
                <ul>
                    <li>
                        <a class="item-link smart-select smart-select-init" data-open-in="popover">
                            <select name="Deposito" multiple id="depositoF">
                                <option value="Para Construir" selected>Para Construir</option>
                                <option value="Botero" selected>Botero</option>
                                <option value="Miranda" selected>Miranda</option>
                                <option value="San Pio" selected>San Pio</option>
                                <option value="Paris" selected>Paris</option>
                                <option value="Medina" selected>Medina</option>
                                <option value="Titan" selected>Titan</option>
                            </select>
                            <div class="item-content">
                                <i class="material-icons md-only icon ifiltro">store</i>
                                <div class="item-inner chevron-center">
                                    <div class="item-title">Deposito</div>
                                </div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
            <div> <button class=" button button-fill color-orange" id="botonFiltro" onclick="filtrarProductos()">Buscar</button></div>

            <div class="list media-list">
                <ul id="lista"></ul>

            </div> 
            <script>
                var contenido;
                var refCemento=db.collection("cemento");
                var filtrados =[];
                var filtradosP =[];   
                var filtradosPyM=[];
                var filtradosPMyD=[];  
                function renderProd(doc) {
                    contenido = "<li><a href='/producto/"+doc.id+"/' class='item-link item-content'><div class='item-media'><img src=" + doc.data().imgP + " width=" + 80 + " /></div><div class='item-inner'><div class='item-title-row'><div class='item-title'>" + doc.data().titulo + "</div><div class='item-after'>$" + doc.data().precio + "</div></div> <div class='item-subtitle'>" + doc.data().tipo + " " + doc.data().marca + "</div><div class='item-text'>" + doc.data().deposito + " " + doc.data().peso + "kg</div></div></a></li>";
                    document.getElementById("lista").innerHTML += contenido;
                }
        
                db.collection('cemento').get().then((snapshot) => {
                    snapshot.docs.forEach(doc => {
                        renderProd(doc);
                    })
                })                                                            
                function filtrarProductos(){
                    document.getElementById("lista").innerHTML = "";                 
                    range = app.range.getValue(".range-slider");
                    val1 = range[0];
                    val2 = range[1];
                    peso = $("#pesoF").val();
                    marca = $("#marcaF").val();
                    deposito = $("#depositoF").val(); 
                    for(var i=0;i<peso.length;i++)peso[i]=parseInt(peso[i]);                              
                    refCemento.where("precio", ">=",parseInt(val1)).where("precio", "<=",parseInt(val2))
                        .get()
                        .then(function(querySnapshot) {
                            querySnapshot.forEach(function(doc) {   
                                if(peso.includes(doc.data().peso) && marca.includes(doc.data().marca) && deposito.includes(doc.data().deposito))
                                renderProd(doc);                                                                                       
                            });
                        })
                        .catch(function(error) {
                            console.log("Error getting documents: ", error);
                        })
                }
                
                                    
                                   
                                  
                    


                
        </script>  
        </div>       
    </div>
</template>

<style>
    .ifiltro {
        padding-right: 10px;
    }
</style>

<script>
  
</script>



